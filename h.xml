<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="hello world example" /> 
  <Content type="html">
     <![CDATA[ 
<!--<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">-->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<style>
    .ui-progressbar {
        position: relative;
    }
    .progress-label {
        position: absolute;
        left: 50%;
        top: 4px;
        font-weight: bold;
        text-shadow: 1px 1px 0 #fff;
    }
    #search-message {
        margin-top: 50px;
    }
    #button-search{
        width: 100%;
    }
    fieldset {
        font-size: 80%;
    }
    img {
        width: 40px;
        height: 40px
    }
</style>

<div class="container-fluid widget" id="search-form">
    <h1 id="demo">Search Gadget2</h1>
    <div class="row" >
        <div class="col-xs-6 col-md-4 form-group">
            <label class="control-label" for="name">Name</label>
            <input type="text" class="form-control" id="name" aria-describedby="helpBlock2">
            <span id="helpBlock2" class="help-block"></span>
        </div>
        <div class="col-xs-6 col-md-4 form-group">
            <label class="control-label" for="phone">Phone number</label>
            <input type="text" class="form-control" id="phone" aria-describedby="helpBlock2">
            <span id="helpBlock2" class="help-block"></span>
        </div>
    </div>
    <fieldset id="field-list">
        <p class="text-success">Filter field list:</p>
        <label for="checkbox-1">Id</label>
        <input type="checkbox" name="id" id="checkbox-1">
        <label for="checkbox-2">Name</label>
        <input type="checkbox" name="name" id="checkbox-2">
        <label for="checkbox-3">Phone</label>
        <input type="checkbox" name="phone" id="checkbox-3">
        <label for="checkbox-4">City</label>
        <input type="checkbox" name="city" id="checkbox-4">
        <label for="checkbox-5">Profile picture</label>
        <input type="checkbox" name="profile_picture" id="checkbox-5">
    </fieldset>
    <div class="row">
        <button id="button-search" type="button" class="btn btn-primary" onclick="search();">Search</button>
    </div>
</div>

<div class="container-fluid" id="search-message">
    <div id="progressbar" hidden><div class="progress-label">Loading...</div></div>
</div>
<div class="container-fluid table-responsive" id="search-body">
    <table  class="table table-bordered  table-hover table-striped table-condensed">
        <tbody></tbody>
    </table>
</div>

<script>
    var SheetApi = function (sheetId, apiKey) {
        var baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets/' + sheetId;

        var getQueryParameters = function () {
            return {
                key: apiKey
            };
        };

        function getSheet(sheet) {
            return $.get(baseUrl + "/values/" + sheet, getQueryParameters());
        }
        ;

        return {
            listSheets: function () {
                return $.get(baseUrl, getQueryParameters());
            },
            getSheet1: function (range) {
                return getSheet('Sheet1' + (range ? ('!' + range) : ''));
            }
        };
    }(
        "1wGy8ABua1GReuwW2vwAmMMbLOvwKh-b9TQ54IBA9fmE",
        "AIzaSyDIs2fHGHxFLWE-O5hLdBtxhZdfx1Jjld4"
        );

    $(function () {
        $('input[type="checkbox"]').checkboxradio({
            icon:true
        });
    });
    function search() {
        var searchButton = $('#button-search');
        searchButton.attr('disabled', true);
        loading();

        var container = $('#search-body table tbody');
        container.html("").hide();

        SheetApi.getSheet1("A1:AA").done(function (data) {
            var header = data.values.shift();
            var body = data.values.reduce(function (body, item) {
                if (header.indexOf('profile_picture') >= 0) {
                    var ix = header.indexOf('profile_picture');
                    item[ix] = '<img src="' + item[ix] + '" class="img-thumbnail">';
                }
                return body
                    + "<tr><td>" + item.join('</td><td>') + "</td></tr>";
            }, "");

            container.html(
                "<tr><th>" + header.join('</th><th>') + "</th></tr>"
                + body
                );
            var searchBody = $('#search-body table');
            $.map($('#field-list input:checked'), function (el){
                var th = searchBody.find('th:contains(' + el.name + ')')[0];

                searchBody.find('tr :nth-child(' + (th.cellIndex + 1) + 'n)').hide()
            });

            container.show();
        }).fail(function () {

        }).always(function () {
            searchButton.attr('disabled', false);
            $("#progressbar").hide();
        });

    }

    function loading() {

        $(function () {
            var progressbar = $("#progressbar"),
                progressLabel = $(".progress-label");

            progressbar.show();

            progressbar.progressbar({
                value: false,
                change: function () {
                    progressLabel.text(progressbar.progressbar("value") + "%");
                },
                complete: function () {
                    progressLabel.text("Complete!");
                }
            });

            function progress() {
                var val = progressbar.progressbar("value") || 0;

                progressbar.progressbar("value", val + 2);

                if (val < 40) {
                    setTimeout(progress, 40);
                } else if (val < 60) {
                    setTimeout(progress, 300);
                } else {
                    setTimeout(progress, 600);
                }
            }

            setTimeout(progress, 3000);
        });
    }
</script>

<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->

]]>
  </Content> 
</Module>
